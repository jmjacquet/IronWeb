{% extends "index.html" %}
{% load static from staticfiles %}
{% load i18n %}
{% load bootstrap3 %}
{% load humanize %}
{% block extra_js %}            
  {{ block.super }}
    <script src="{% static 'js/scripts/scripts_cheques.js'%}?{% now "Ymd"%}" type="text/javascript"></script>    
{% endblock %}
{% block main %} 
    
<div class="col-sm-12">   
      <div class="portlet box toolbar_blue">
            <div class="portlet-title">
                <div class="caption bold"><i class="icon-calendar"></i>SEGUIMIENTO CHEQUES</div>
                <div class="actions">
                            <button tittle="Búsqueda Avanzada" data-toggle="collapse" aria-expanded="true"  class="btn btn-circle active" data-target="#barra_busqueda" aria-controls="barra_busqueda"><i class="glyphicon glyphicon-search"></i></button>                          
                    </div>        
            </div> 
      </div>
      <div class="row collapse" id="barra_busqueda">
          <div class="col-md-12">
              <form class="form" accept-charset="UTF-8" role="form" action="" method="post">
                  {% csrf_token %} 
                  <div class="barra_busqueda  col-xs-12">
                      <div class="col-sm-1 col-xs-3">{% bootstrap_field form.fdesde  %}</div>                                
                      <div class="col-sm-1 col-xs-3">{% bootstrap_field form.fhasta  %}</div>
                      <div class="col-sm-1 col-xs-4"><button class="btn btn-sm color_barra" type="submit">Buscar</button></div>
                  </div>     
              </form>                    
          </div>
      </div>   

      <div class="tabbable-line">
              <ul class="nav nav-tabs ">
                  <li class="active">
                      <a href="#tab_15_1" data-toggle="tab" aria-expanded="true">EN CARTERA</a>
                  </li>
                  <li>
                      <a href="#tab_15_2" data-toggle="tab" aria-expanded="true">COBRADOS/DEPOSITADOS</a>                            
                  </li>                        
                  <li>
                      <a href="#tab_15_3" data-toggle="tab" aria-expanded="true">PAGADOS/DIFERIDOS</a>
                  </li>                        
                  <li>
                      <a href="#tab_15_4" data-toggle="tab" aria-expanded="true">TODOS</a>
                  </li>  
              </ul>
              <div class="tab-content">
                  <div class="tab-pane active" id="tab_15_1">
                      <div class="col-xs-12">                                 
                          <div class="btn-group " style="float:left;margin-right:20px;margin-bottom:10px;">                                   
                            <button class="btn btn-sm blue-hoki" value="" style="margin-right:20px;" id="btnCobro">Cobrar / Depositar</button>                            
                          </div>                                 
                          <table id="dataTables-cartera" class="table table-striped compact table-hover table-no-bordered tabla_nueva nowrap">         
                              <thead>
                                  <tr>
                                    <th class="no-sort text-center"></th>
                                    <th>Fecha</th>                                                  
                                    <th>Número</th>                                                  
                                    <th>Banco</th>
                                    <th>Vencimiento</th>  
                                    <th class="importe">Importe</th>                                  
                                    <th>CPB Origen</th>
                                    <th>Cliente</th>                                                  
                                  </tr>
                              </thead>
                              <tbody>
                                 {% for i in cartera %}
                                  <tr>                                
                                   <td class="no-sort text-center">
                                      <input class="hidden" value="{{i.pk|safe}}" id="chk_{{forloop.counter0}}_id_fp" /><input type="checkbox" class='selecc' id="chk_{{forloop.counter0}}" value="{{ i.importe }}"/>                                     
                                   </td>
                                   <td title="{{i.pk|safe}}">{{i.cpb_comprobante.fecha_cpb|date:'d/m/Y'}}</td>                                                  
                                   <td >{{i.mdcp_cheque|default_if_none:''}}</td>                                                 
                                   <td class="">{{i.mdcp_banco|default_if_none:''}}</td> 
                                   <td class="">{{i.mdcp_fecha|date:'d/m/Y'}}</td> 
                                   <td class="importe">$ {{i.importe|default_if_none:0|floatformat:2}}</td>
                                   <td title="{{i.cpb_comprobante.cpb_tipo|default_if_none:''}}" class="">
                                    <a href="{% url 'recibo_ver' id=i.cpb_comprobante.id %}"  title="VER" class="modal-detail" data-modal-head="DETALLE {{i.cpb_comprobante.cpb_tipo.nombre|upper}} {{i.cpb_comprobante}}   Fecha:{{i.cpb_comprobante.fecha_cpb|date:'d/m/Y'}}  Vencimiento:{{i.cpb_comprobante.fecha_vto|date:'d/m/Y'}}" data-fm-callback="reload">  
                                      <i class="fa fa-list-alt text-primary"></i></a>{{i.cpb_comprobante.cpb_tipo.codigo|default_if_none:''}}: {{i.cpb_comprobante|default_if_none:''}}</td>
                                   <td class="">{{i.cpb_comprobante.entidad|default_if_none:''}}</td> 
                                  </tr>
                                 {% endfor %}
                              </tbody>
                              <tfoot>
                                 <tr>                                                
                                  <th></th>
                                  <th></th>
                                  <th></th>
                                  <th></th> 
                                  <th></th>                                               
                                  <th class="importe"></th>                                                     
                                  <th></th>
                                  <th></th>
                                 </tr>
                              </tfoot>
                          </table> 
                      </div>
                  </div>
                  <div class="tab-pane" id="tab_15_2">
                      <div class="col-xs-12">
                          <table id="dataTables-cobrados" class="table table-striped compact table-hover table-no-bordered tabla_nueva nowrap">         
                              <thead>
                                  <tr>
                                    <th>Fecha</th>                                                  
                                    <th>Número</th>                                                  
                                    <th >Banco</th>
                                    <th >Cuenta Destino</th>
                                    <th >Vencimiento</th>                 
                                    <th class="importe" >Importe</th>                                  
                                    <th>CPB Origen</th>                                                  
                                    <th>CPB Destino</th> 
                                    <th>Cliente</th>
                                  </tr>
                              </thead>
                              <tbody>
                                 {% for i in cobrados %}
                                  <tr>                                
                                   <td title="{{i.pk|safe}}" class="">{{i.cpb_comprobante.fecha_cpb|date:'d/m/Y'}}</td>
                                   <td class="">{{i.mdcp_cheque|default_if_none:''}}</td>           
                                   <td class="">{{i.mdcp_banco|default_if_none:''}}</td> 
                                   <td class="">{{i.mdcp_salida.cta_ingreso|default_if_none:''}}</td>
                                   <td class="">{{i.mdcp_fecha|date:'d/m/Y'}}</td> 
                                   <td class="importe">$ {{i.importe|default_if_none:0|floatformat:2}}</td>
                                   <td title="{{i.cpb_comprobante.cpb_tipo|default_if_none:''}}" class="">
                                    <a href="{% url 'recibo_ver' id=i.cpb_comprobante.id %}"  title="VER" class="modal-detail" data-modal-head="DETALLE {{i.cpb_comprobante.cpb_tipo.nombre|upper}} {{i.cpb_comprobante}}   Fecha:{{i.cpb_comprobante.fecha_cpb|date:'d/m/Y'}}  Vencimiento:{{i.cpb_comprobante.fecha_vto|date:'d/m/Y'}}" data-fm-callback="reload">  
                                      <i class="fa fa-list-alt text-primary"></i></a>{{i.cpb_comprobante.cpb_tipo.codigo|default_if_none:''}}: {{i.cpb_comprobante|default_if_none:''}}</td>
                                    <td title="{{i.mdcp_salida.cpb_comprobante.cpb_tipo|default_if_none:''}}" class="">
                                    <a href="{% url 'recibo_ver' id=i.mdcp_salida.cpb_comprobante.id %}"  title="VER" class="modal-detail" data-modal-head="DETALLE {{i.mdcp_salida.cpb_comprobante.cpb_tipo.nombre|upper}} {{i.mdcp_salida.cpb_comprobante}}   Fecha:{{i.mdcp_salida.cpb_comprobante.fecha_cpb|date:'d/m/Y'}}  Vencimiento:{{i.mdcp_salida.cpb_comprobante.fecha_vto|date:'d/m/Y'}}" data-fm-callback="reload">  
                                      <i class="fa fa-list-alt text-primary"></i></a>{{i.mdcp_salida.cpb_comprobante.cpb_tipo.codigo|default_if_none:''}}: {{i.mdcp_salida.cpb_comprobante|default_if_none:''}}</td>
                                   <td class="">{{i.cpb_comprobante.entidad|default_if_none:''}}</td>
                                 {% endfor %}
                              </tbody>
                              <tfoot>
                                 <tr>                                                
                                  <th></th>
                                  <th></th>
                                  <th></th>
                                  <th></th>                                                
                                  <th></th>
                                  <th class="importe"></th>                                                     
                                  <th></th>
                                  <th></th>
                                  <th></th>
                                 </tr>
                              </tfoot>
                          </table> 
                      </div>
                  </div>
                  <div class="tab-pane" id="tab_15_3">
                      <div class="col-xs-12">                                     
                          <table id="dataTables-pagados" class="table table-striped compact table-hover table-no-bordered tabla_nueva nowrap">         
                              <thead>
                                  <tr>
                                    <th>Fecha</th>                                                  
                                    <th>Número</th>                                                  
                                    <th >Banco</th>
                                    <th >Vencimiento</th>   
                                    <th class="importe" >Importe</th>                                  
                                    <th>Comprobante</th>
                                    <th>CPB Origen</th>
                                    <th>Proveedor</th>                                                  
                                  </tr>
                              </thead>
                              <tbody>
                                 {% for i in pagados %}
                                  <tr>                                
                                   <td title="{{i.pk|safe}}" class="">{{i.cpb_comprobante.fecha_cpb|date:'d/m/Y'}}</td>                                                  
                                   <td class="">{{i.mdcp_cheque|default_if_none:''}}</td>                                                 
                                   <td class="">{{i.mdcp_banco|default_if_none:''}}</td> 
                                   <td class="">{{i.mdcp_fecha|date:'d/m/Y'}}</td> 
                                   <td class="importe">$ {{i.importe|default_if_none:0|floatformat:2}}</td>
                                   <td title="{{i.cpb_comprobante.cpb_tipo|default_if_none:''}}" class="">
                                    <a href="{% url 'recibo_ver' id=i.cpb_comprobante.id %}"  title="VER" class="modal-detail" data-modal-head="DETALLE {{i.cpb_comprobante.cpb_tipo.nombre|upper}} {{i.cpb_comprobante}}   Fecha:{{i.cpb_comprobante.fecha_cpb|date:'d/m/Y'}}  Vencimiento:{{i.cpb_comprobante.fecha_vto|date:'d/m/Y'}}" data-fm-callback="reload">  
                                      <i class="fa fa-list-alt text-primary"></i></a>{{i.cpb_comprobante.cpb_tipo.codigo|default_if_none:''}}: {{i.cpb_comprobante|default_if_none:''}}</td>
                                   <td title="{{i.get_origen.cpb_tipo|default_if_none:''}}" class="">{% if i.get_origen %}
                                    <a href="{% url 'recibo_ver' id=i.get_origen.id %}"  title="VER" class="modal-detail" data-modal-head="DETALLE {{i.get_origen.cpb_tipo.nombre|upper}} {{i.get_origen}}   Fecha:{{i.get_origen.fecha_cpb|date:'d/m/Y'}}  Vencimiento:{{i.get_origen.fecha_vto|date:'d/m/Y'}}" data-fm-callback="reload">  
                                      <i class="fa fa-list-alt text-primary"></i></a>{{i.get_origen.cpb_tipo.codigo|default_if_none:''}}: {{i.get_origen|default_if_none:''}}{% endif %}
                                    </td>

                                   <td class="">{{i.cpb_comprobante.entidad|default_if_none:''}}</td>
                                  </tr>
                                 {% endfor %}
                              </tbody>
                              <tfoot>
                                 <tr>                                                
                                  <th></th>
                                  <th></th>
                                  <th></th>
                                  <th></th>                                                
                                  <th class="importe"></th>                                                     
                                  <th></th>
                                  <th></th>
                                  <th></th>   
                                 </tr>
                              </tfoot>
                          </table>                                               
                      </div>
                  </div>
                  <div class="tab-pane" id="tab_15_4">
                      <div class="col-xs-12">
                          <table id="dataTables-cheques" class="table table-striped compact table-hover table-no-bordered tabla_nueva nowrap">         
                              <thead>
                                  <tr>
                                    <th>Fecha</th>                                                  
                                    <th>Número</th>                                                  
                                    <th>Estado</th>
                                    <th >Banco</th>
                                    <th >Vencimiento</th>    
                                    <th class="importe">Importe</th>                                  
                                    <th>Comprobante</th>
                                    <th>Entidad</th>                                                  
                                  </tr>
                              </thead>
                              <tbody>
                                 {% for c in cheques %}
                                  <tr>                                
                                   <td title="{{c.pk|safe}}" class="">{{c.cpb_comprobante.fecha_cpb|date:'d/m/Y'}}</td>                                                  
                                   <td class="">{{c.mdcp_cheque|default_if_none:''}}</td>                                                 
                                   <td class="">{{c.get_estadoCheque|default_if_none:''}}</td>                                                 
                                   <td class="">{{c.mdcp_banco|default_if_none:''}}</td> 
                                   <td class="">{{c.mdcp_fecha|date:'d/m/Y'}}</td> 
                                   <td class="importe">$ {{c.importe|default_if_none:0|floatformat:2}}</td>
                                   <td title="{{c.cpb_comprobante.cpb_tipo|default_if_none:''}}" class="">
                                    <a href="{% url 'recibo_ver' id=c.cpb_comprobante.id %}"  title="VER" class="modal-detail" data-modal-head="DETALLE {{c.cpb_comprobante.cpb_tipo.nombre|upper}} {{c.cpb_comprobante}}   Fecha:{{c.cpb_comprobante.fecha_cpb|date:'d/m/Y'}}  Vencimiento:{{c.cpb_comprobante.fecha_vto|date:'d/m/Y'}}" data-fm-callback="reload">  
                                      <i class="fa fa-list-alt text-primary"></i></a>{{c.cpb_comprobante.cpb_tipo.codigo|default_if_none:''}}: {{c.cpb_comprobante|default_if_none:''}}</td>
                                   <td class="">{{c.cpb_comprobante.entidad|default_if_none:''}}</td> 
                                  </tr>
                                 {% endfor %}
                              </tbody>
                              <tfoot>
                                 <tr>                                                
                                  <th></th>
                                  <th></th>
                                  <th></th>
                                  <th></th>  
                                  <th></th>                                               
                                  <th class="importe"></th>                                                     
                                  <th></th>
                                  <th></th>
                                 </tr>
                              </tfoot>
                          </table> 
                      </div>
                  </div>
              </div>
        </div>                                
</div>


<script type="text/javascript">

$(document).ready(function() { 

   
$.fn.datepicker.dates['es'] = {
    days: ["Domingo", "Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado", "Domingo"],
    daysShort: ["Dom", "Lun", "Mar", "Mié", "Jue", "Vie", "Sáb", "Dom"],
    daysMin: ["Do", "Lu", "Ma", "Mi", "Ju", "Vi", "Sa", "Do"],
    months: ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"],
    monthsShort: ["Ene", "Feb", "Mar", "Abr", "May", "Jun", "Jul", "Ago", "Sep", "Oct", "Nov", "Dic"],
    today: "Hoy"
  };
  
   $('.datepicker').datepicker({
          format: "dd/mm/yyyy",
          language: "es",
          autoclose: true,
          todayHighlight: true
    }); 
    
moment.locale('es');
$.fn.dataTable.moment('DD/MM/YYYY'); 


var tabla2 = $('#dataTables-cartera').DataTable({
            "language": {
                "decimal": ",",
                "thousands": ".",                
                "sProcessing": "Procesando...",
                "sLengthMenu": "Mostrar _MENU_ registros",
                "sZeroRecords": "No se encontraron resultados",
                "sEmptyTable": "No hay registros en esta tabla",
                "sInfo": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                "sInfoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
                "sInfoPostFix": "",
                "sSearch": "Buscar:",
                "sUrl": "",
                "sInfoThousands": ".",
                "sLoadingRecords": "Cargando...",
                "oPaginate": {
                    "sFirst": "Primero",
                    "sLast": "Último",
                    "sNext": "Siguiente",
                    "sPrevious": "Anterior"
                },
                "oAria": {
                    "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
                    "sSortDescending": ": Activar para ordenar la columna de manera descendente"
                },
                      
            },                      
            "columnDefs": [ {
                  "targets"  : 'no-sort',
                  "orderable": false,
                }],                    
           "paging":   false,
           "autoWidth": true,
           "order": [],
           "colReorder": true,
           "searching": true,
            fixedHeader: {
              header: false,
              footer: false
              },
            responsive: true,
            dom: 'Bfrtlip',
            buttons: [
                {
                    extend:    'colvis',
                    text:      '<i class="fa fa-list"></i>',
                    titleAttr: 'Ver/Ocultar',
                    className: 'btnToolbar',                    
                },
                {
                    extend:    'copyHtml5',
                    text:      '<i class="fa fa-files-o"></i>',
                    titleAttr: 'Copiar',
                    exportOptions: { columns: ':visible' },
                    className: 'btnToolbar',     

                },
                {
                    extend:    'excel',
                    text:      '<i class="fa fa-file-excel-o"></i>',
                    titleAttr: 'Excel',
                    filename: 'CHEQUES_CARTERA',                    
                    exportOptions: {  modifier: {
                                        page: 'current'
                                    }, 
                                      columns: ':visible',
                                      format: {
                                      body: function(data, row, column, node) {
                                        var floatVal = function (i) {
                                            if (typeof i === "number") {
                                                return i;
                                            } else if (typeof i === "string") {
                                                i = i.replace(/\$/g, "");
                    i = i.replace(/\,/g ,"");                    
                    i = i.replace(/\./g, "");
                                                var result = parseFloat(i)/100;
                                                // console.log(result);
                                                if (isNaN(result)) {
                                                    try {
                                                        var result = $jq(i).text();
                                                        result = parseFloat(result);
                                                        if (isNaN(result)) { result = 0 };
                                                        return result * 1;
                                                    } catch (error) {
                                                        return 0;
                                                    }
                                                } else {
                                                    return result * 1;
                                                }
                                            } else {
                                                alert("Unhandled type for totals [" + (typeof i) + "]");
                                                return 0
                                            }
                                        };
                                          data = $('<p>' + data + '</p>').text();
                                          return (node.className=='importe') ? floatVal(data)  : data;
                                      }
                                    }},
                    className: 'btnToolbar',     
                },
                        
                {
                    extend:    'pdfHtml5',
                    text:      '<i class="fa fa-file-pdf-o"></i>',
                    titleAttr: 'PDF',footer: true,
                    exportOptions: { columns: ':visible'},
                    orientation: 'landscape',
                    className: 'btnToolbar',                    
                },
                {
                    extend: 'print',
                    text:      '<i class="fa fa-print"></i>',
                    titleAttr: 'Imprimir',
                    exportOptions: { columns: ':visible' },
                    className: 'btnToolbar',                    
                },
            ],
        
            footerCallback: function ( row, data, start, end, display ) {
            var api = this.api(), data;
            var floatVal = function (i) {
                if (typeof i === "number") {
                    return i;
                } else if (typeof i === "string") {
                    i = i.replace(/\$/g, "");
                    i = i.replace(/\,/g ,"");                    
                    i = i.replace(/\./g, "");
                    var result = parseFloat(i)/100;
                    // console.log(result);
                    if (isNaN(result)) {
                        try {
                            var result = $jq(i).text();
                            result = parseFloat(result);
                            if (isNaN(result)) { result = 0 };
                            return result * 1;
                        } catch (error) {
                            return 0;
                        }
                    } else {
                        return result * 1;
                    }
                } else {
                    alert("Unhandled type for totals [" + (typeof i) + "]");
                    return 0
                }
            };
            
            pageTotal = api.column(5, { page: 'current'} ).data().reduce( function (a, b) {return floatVal(a) + floatVal(b);}, 0 );
            $( api.column(5).footer() ).html('$'+pageTotal.toLocaleString());      
         
        }
        });


var tabla3 = $('#dataTables-cobrados').DataTable({
            "language": {
                "decimal": ",",
                "thousands": ".",                
                "sProcessing": "Procesando...",
                "sLengthMenu": "Mostrar _MENU_ registros",
                "sZeroRecords": "No se encontraron resultados",
                "sEmptyTable": "No hay registros en esta tabla",
                "sInfo": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                "sInfoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
                "sInfoPostFix": "",
                "sSearch": "Buscar:",
                "sUrl": "",
                "sInfoThousands": ".",
                "sLoadingRecords": "Cargando...",
                "oPaginate": {
                    "sFirst": "Primero",
                    "sLast": "Último",
                    "sNext": "Siguiente",
                    "sPrevious": "Anterior"
                },
                "oAria": {
                    "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
                    "sSortDescending": ": Activar para ordenar la columna de manera descendente"
                },
                      
            },                      
            "columnDefs": [ {
                  "targets"  : 'no-sort',
                  "orderable": false,
                }],                    
           "paging":   false,
           "autoWidth": false,
           "order": [],
           "colReorder": true,
           "searching": true,
            fixedHeader: {
              header: false,
              footer: false
              },
            responsive: true,
            dom: 'Bfrtlip',
            buttons: [
                {
                    extend:    'colvis',
                    text:      '<i class="fa fa-list"></i>',
                    titleAttr: 'Ver/Ocultar',
                    className: 'btnToolbar',                    
                },
                {
                    extend:    'copyHtml5',
                    text:      '<i class="fa fa-files-o"></i>',
                    titleAttr: 'Copiar',
                    exportOptions: { columns: ':visible' },
                    className: 'btnToolbar',     

                },
                {
                    extend:    'excel',
                    text:      '<i class="fa fa-file-excel-o"></i>',
                    titleAttr: 'Excel',
                    filename: 'CHEQUES_COBRADOS',                    
                    exportOptions: {  modifier: {
                                        page: 'current'
                                    }, 
                                      columns: ':visible',
                                      format: {
                                      body: function(data, row, column, node) {
                                        var floatVal = function (i) {
                                            if (typeof i === "number") {
                                                return i;
                                            } else if (typeof i === "string") {
                                                i = i.replace(/\$/g, "");
                    i = i.replace(/\,/g ,"");                    
                    i = i.replace(/\./g, "");
                                                var result = parseFloat(i)/100;
                                                // console.log(result);
                                                if (isNaN(result)) {
                                                    try {
                                                        var result = $jq(i).text();
                                                        result = parseFloat(result);
                                                        if (isNaN(result)) { result = 0 };
                                                        return result * 1;
                                                    } catch (error) {
                                                        return 0;
                                                    }
                                                } else {
                                                    return result * 1;
                                                }
                                            } else {
                                                alert("Unhandled type for totals [" + (typeof i) + "]");
                                                return 0
                                            }
                                        };
                                          data = $('<p>' + data + '</p>').text();
                                          return (node.className=='importe') ? floatVal(data)  : data;
                                      }
                                    }},
                    className: 'btnToolbar',     
                },
                        
                {
                    extend:    'pdfHtml5',
                    text:      '<i class="fa fa-file-pdf-o"></i>',
                    titleAttr: 'PDF',footer: true,
                    exportOptions: { columns: ':visible'},
                    orientation: 'landscape',
                    className: 'btnToolbar',                    
                },
                {
                    extend: 'print',
                    text:      '<i class="fa fa-print"></i>',
                    titleAttr: 'Imprimir',
                    exportOptions: { columns: ':visible' },
                    className: 'btnToolbar',                    
                },
            ],           
            footerCallback: function ( row, data, start, end, display ) {
            var api = this.api(), data;
            var floatVal = function (i) {
                if (typeof i === "number") {
                    return i;
                } else if (typeof i === "string") {
                    i = i.replace(/\$/g, "");
                    i = i.replace(/\,/g ,"");                    
                    i = i.replace(/\./g, "");
                    var result = parseFloat(i)/100;
                    // console.log(result);
                    if (isNaN(result)) {
                        try {
                            var result = $jq(i).text();
                            result = parseFloat(result);
                            if (isNaN(result)) { result = 0 };
                            return result * 1;
                        } catch (error) {
                            return 0;
                        }
                    } else {
                        return result * 1;
                    }
                } else {
                    alert("Unhandled type for totals [" + (typeof i) + "]");
                    return 0
                }
            };
            
            pageTotal = api.column(5, { page: 'current'} ).data().reduce( function (a, b) {return floatVal(a) + floatVal(b);}, 0 );
            $( api.column(5).footer() ).html('$'+pageTotal.toLocaleString());      
         
        }
        });

var tabla4 = $('#dataTables-pagados').DataTable({
            "language": {
                "decimal": ",",
                "thousands": ".",                
                "sProcessing": "Procesando...",
                "sLengthMenu": "Mostrar _MENU_ registros",
                "sZeroRecords": "No se encontraron resultados",
                "sEmptyTable": "No hay registros en esta tabla",
                "sInfo": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                "sInfoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
                "sInfoPostFix": "",
                "sSearch": "Buscar:",
                "sUrl": "",
                "sInfoThousands": ".",
                "sLoadingRecords": "Cargando...",
                "oPaginate": {
                    "sFirst": "Primero",
                    "sLast": "Último",
                    "sNext": "Siguiente",
                    "sPrevious": "Anterior"
                },
                "oAria": {
                    "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
                    "sSortDescending": ": Activar para ordenar la columna de manera descendente"
                },
                      
            },                      
            "columnDefs": [ {
                  "targets"  : 'no-sort',
                  "orderable": false,
                }],                    
           "paging":   false,
           "autoWidth": false,
           "order": [],
           "colReorder": true,
           "searching": true,
            fixedHeader: {
              header: false,
              footer: false
              },
            responsive: true,
            dom: 'Bfrtlip',
            buttons: [
                {
                    extend:    'colvis',
                    text:      '<i class="fa fa-list"></i>',
                    titleAttr: 'Ver/Ocultar',
                    className: 'btnToolbar',                    
                },
                {
                    extend:    'copyHtml5',
                    text:      '<i class="fa fa-files-o"></i>',
                    titleAttr: 'Copiar',
                    exportOptions: { columns: ':visible' },
                    className: 'btnToolbar',     

                },
                {
                    extend:    'excel',
                    text:      '<i class="fa fa-file-excel-o"></i>',
                    titleAttr: 'Excel',
                    filename: 'CHEQUES_PAGADOS',                    
                    exportOptions: {  modifier: {
                                        page: 'current'
                                    }, 
                                      columns: ':visible',
                                      format: {
                                      body: function(data, row, column, node) {
                                        var floatVal = function (i) {
                                            if (typeof i === "number") {
                                                return i;
                                            } else if (typeof i === "string") {
                                                i = i.replace(/\$/g, "");
                    i = i.replace(/\,/g ,"");                    
                    i = i.replace(/\./g, "");
                                                var result = parseFloat(i)/100;
                                                // console.log(result);
                                                if (isNaN(result)) {
                                                    try {
                                                        var result = $jq(i).text();
                                                        result = parseFloat(result);
                                                        if (isNaN(result)) { result = 0 };
                                                        return result * 1;
                                                    } catch (error) {
                                                        return 0;
                                                    }
                                                } else {
                                                    return result * 1;
                                                }
                                            } else {
                                                alert("Unhandled type for totals [" + (typeof i) + "]");
                                                return 0
                                            }
                                        };
                                          data = $('<p>' + data + '</p>').text();
                                          return (node.className=='importe') ? floatVal(data)  : data;
                                      }
                                    }},
                    className: 'btnToolbar',     
                },
                        
                {
                    extend:    'pdfHtml5',
                    text:      '<i class="fa fa-file-pdf-o"></i>',
                    titleAttr: 'PDF',footer: true,
                    exportOptions: { columns: ':visible'},
                    orientation: 'landscape',
                    className: 'btnToolbar',                    
                },
                {
                    extend: 'print',
                    text:      '<i class="fa fa-print"></i>',
                    titleAttr: 'Imprimir',
                    exportOptions: { columns: ':visible' },
                    className: 'btnToolbar',                    
                },
            ],
          
            footerCallback: function ( row, data, start, end, display ) {
            var api = this.api(), data;
            var floatVal = function (i) {
                if (typeof i === "number") {
                    return i;
                } else if (typeof i === "string") {
                    i = i.replace(/\$/g, "");
                    i = i.replace(/\,/g ,"");                    
                    i = i.replace(/\./g, "");
                    var result = parseFloat(i)/100;
                    // console.log(result);
                    if (isNaN(result)) {
                        try {
                            var result = $jq(i).text();
                            result = parseFloat(result);
                            if (isNaN(result)) { result = 0 };
                            return result * 1;
                        } catch (error) {
                            return 0;
                        }
                    } else {
                        return result * 1;
                    }
                } else {
                    alert("Unhandled type for totals [" + (typeof i) + "]");
                    return 0
                }
            };
            
            pageTotal = api.column(4, { page: 'current'} ).data().reduce( function (a, b) {return floatVal(a) + floatVal(b);}, 0 );
            $( api.column(4).footer() ).html('$'+pageTotal.toLocaleString());      
         
        }
        });
var tabla = $('#dataTables-cheques').DataTable({
            "language": {
                "decimal": ",",
                "thousands": ".",                
                "sProcessing": "Procesando...",
                "sLengthMenu": "Mostrar _MENU_ registros",
                "sZeroRecords": "No se encontraron resultados",
                "sEmptyTable": "No hay registros en esta tabla",
                "sInfo": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                "sInfoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
                "sInfoPostFix": "",
                "sSearch": "Buscar:",
                "sUrl": "",
                "sInfoThousands": ".",
                "sLoadingRecords": "Cargando...",
                "oPaginate": {
                    "sFirst": "Primero",
                    "sLast": "Último",
                    "sNext": "Siguiente",
                    "sPrevious": "Anterior"
                },
                "oAria": {
                    "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
                    "sSortDescending": ": Activar para ordenar la columna de manera descendente"
                },
                      
            },                      
            "columnDefs": [ {
                  "targets"  : 'no-sort',
                  "orderable": false,
                }],                    
           "paging":   false,
           "autoWidth": false,
           "order": [],
           "colReorder": true,
           "searching": true,
            fixedHeader: {
              header: false,
              footer: false
              },
            responsive: true,
            dom: 'Bfrtlip',
            buttons: [
                {
                    extend:    'colvis',
                    text:      '<i class="fa fa-list"></i>',
                    titleAttr: 'Ver/Ocultar',
                    className: 'btnToolbar',                    
                },
                {
                    extend:    'copyHtml5',
                    text:      '<i class="fa fa-files-o"></i>',
                    titleAttr: 'Copiar',
                    exportOptions: { columns: ':visible' },
                    className: 'btnToolbar',     

                },
                {
                    extend:    'excel',
                    text:      '<i class="fa fa-file-excel-o"></i>',
                    titleAttr: 'Excel',
                    filename: 'CHEQUES',                    
                    exportOptions: {  modifier: {
                                        page: 'current'
                                    }, 
                                      columns: ':visible',
                                      format: {
                                      body: function(data, row, column, node) {
                                        var floatVal = function (i) {
                                            if (typeof i === "number") {
                                                return i;
                                            } else if (typeof i === "string") {
                                                i = i.replace(/\$/g, "");
                    i = i.replace(/\,/g ,"");                    
                    i = i.replace(/\./g, "");
                                                var result = parseFloat(i)/100;
                                                // console.log(result);
                                                if (isNaN(result)) {
                                                    try {
                                                        var result = $jq(i).text();
                                                        result = parseFloat(result);
                                                        if (isNaN(result)) { result = 0 };
                                                        return result * 1;
                                                    } catch (error) {
                                                        return 0;
                                                    }
                                                } else {
                                                    return result * 1;
                                                }
                                            } else {
                                                alert("Unhandled type for totals [" + (typeof i) + "]");
                                                return 0
                                            }
                                        };
                                          data = $('<p>' + data + '</p>').text();
                                          return (node.className=='importe') ? floatVal(data)  : data;
                                      }
                                    }},
                    className: 'btnToolbar',     
                },
                        
                {
                    extend:    'pdfHtml5',
                    text:      '<i class="fa fa-file-pdf-o"></i>',
                    titleAttr: 'PDF',footer: true,
                    exportOptions: { columns: ':visible'},
                    orientation: 'landscape',
                    className: 'btnToolbar',                    
                },
                {
                    extend: 'print',
                    text:      '<i class="fa fa-print"></i>',
                    titleAttr: 'Imprimir',
                    exportOptions: { columns: ':visible' },
                    className: 'btnToolbar',                    
                },
            ],
            initComplete: function () {
               // this.api().columns().every( function () {[0, 1, 9]
                this.api().columns([2]).every( function () {
                    var column = this;
                    var select = $('<select class="form-control"><option value="">Todos</option></select>')
                        .appendTo( $(column.footer()).empty() )
                        .on( 'change', function () {
                            var val = $.fn.dataTable.util.escapeRegex(
                                $(this).val()
                            );
     
                            column
                                .search( val ? '^'+val+'$' : '', true, false )
                                .draw();
                        } );
     
                     column.data().unique().sort().each( function ( d, j ) {
                    //column.cells('', column[0]).render('display').sort().unique().each( function ( d, j ){
                        select.append( '<option value="'+d+'">'+d+'</option>' )
                    } );
                } );

            },
            footerCallback: function ( row, data, start, end, display ) {
              var api = this.api(), data;
              var floatVal = function (i) {
                  if (typeof i === "number") {
                      return i;
                  } else if (typeof i === "string") {
                      i = i.replace("$", "")
                      i = i.replace(",", "")
                      i = i.replace(".", "")
                      var result = parseFloat(i)/100;
                      // console.log(result);
                      if (isNaN(result)) {
                          try {
                              var result = $jq(i).text();
                              result = parseFloat(result);
                              if (isNaN(result)) { result = 0 };
                              return result * 1;
                          } catch (error) {
                              return 0;
                          }
                      } else {
                          return result * 1;
                      }
                  } else {
                      alert("Unhandled type for totals [" + (typeof i) + "]");
                      return 0
                  }
              };
              
              pageTotal = api.column(5, { page: 'current'} ).data().reduce( function (a, b) {return floatVal(a) + floatVal(b);}, 0 );
              $( api.column(5).footer() ).html('$'+pageTotal.toLocaleString());      
         
            }
        });
});


</script>


{% endblock main %}





